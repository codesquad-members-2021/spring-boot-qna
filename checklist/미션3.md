
## ë¯¸ì…˜ 3. ë¡œê·¸ì¸ êµ¬í˜„

### ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„
> ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.

> ë¡œê·¸ì¸ ìƒíƒœ â†’ ìƒë‹¨ ë©”ë‰´ : â€œë¡œê·¸ì•„ì›ƒâ€, â€œê°œì¸ì •ë³´ìˆ˜ì •â€

> ë¡œê·¸ì•„ì›ƒ ìƒíƒœ â†’ ìƒë‹¨ ë©”ë‰´ : â€œë¡œê·¸ì¸â€, â€œíšŒì›ê°€ì…â€

- [X] ë¡œê·¸ì¸ êµ¬í˜„
    - UserControllerì— login() ë©”ì†Œë“œ êµ¬í˜„
        - url `/users/login`ê³¼ ë§¤í•‘
            ```java
            @PostMapping("/login")
            public String login(String userId, String password, HttpSession session) {
                // ë¡œê·¸ì¸ ë¡œì§ êµ¬í˜„
            }
            ```
        - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ HttpSessionì— ë¡œê·¸ì¸ ì •ë³´ ì¶”ê°€
           ```java
            session.setAttribute(â€œsessionedUser", user);
           ```
    - templates/user/login.html í™•ì¸
        - ë¡œê·¸ì¸ formì˜ actionì˜ url â†’ `/users/login`ìœ¼ë¡œ ìˆ˜ì •

    - UserRepository
        - userIdì— í•´ë‹¹í•˜ëŠ” ë°ì´í„° ì¡°íšŒ
      ```java
      public interface UserRepository extends JpaRepository<User, Long>{
          User findByUserId(String userId);
      }
      ```


- [X] ë¡œê·¸ì¸ì— ë”°ë¥¸ ë©”ë‰´ ì²˜ë¦¬ êµ¬í˜„
    - ì„¸ì…˜ ì„¤ì •
        - application.properties
            - handlebarsì—ì„œ HttpSession ë°ì´í„°ë¥¼ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì„¤ì •
       ```java
        handlebars.expose-session-attributes=true
       ```
        - URLì— jsessionidê°€ ì¶”ê°€ë˜ëŠ” ì´ìŠˆë¥¼ í•´ê²°í•˜ëŠ” ì„¤ì •
       ```java
        // spring boot 1.5
        server.session.tracking-modes=cookie
        
        // spring boot 2.x
        server.servlet.session.tracking-modes=cookie
       ```
    - HTML ë¬¸ì„œì—ì„œ if/else ì‚¬ìš©
        - if/else êµ¬ë¬¸ìœ¼ë¡œ ë¡œê·¸ì¸ ì„±ê³µ ì—¬ë¶€ì— ë”°ë¼ ë„ìš°ëŠ” í˜ì´ì§€ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•œë‹¤.
      ```html
      {{^sessionedUser}}
      [[HTML êµ¬ë¬¸]
      {{/sessionedUser}}
      {{#sessionedUser}}
      [[HTML êµ¬ë¬¸]
      {{/sessionedUser}}
      ```
      
   - [X] ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ êµ¬í˜„
      - @GetMapping("/logout")
      - ì¸ìë¡œ HttpSession ë°›ê¸°
      - session.removeAttribute("sessionedUser")
    
### í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
> ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ë§¤ë²ˆ íšŒì›ê°€ì…ì„ ë¨¼ì € í•´ì•¼ í•œë‹¤.

> ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ”ë° ì–´ë ¤ì›€ì´ ìˆë‹¤. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ì¶”ê°€í•œ í›„ ê°œë°œì„ í•˜ë©´ ì¢‹ê² ë‹¤.

- [X] ê¶Œí•œ ì²´í¬ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
    -  sql íŒŒì¼ì„ ì¶”ê°€
    - src/main/resources í´ë” ì•„ë˜ data.sql íŒŒì¼ ìƒì„±
    - ì‚¬ìš©ì ë°ì´í„° insert sql ì¿¼ë¦¬ ì¶”ê°€
      ```java
      INSERT INTO USER (id, user_id, password, name, email) VALUES (1, 'javajigi', 'test', 'ìë°”ì§€ê¸°', 'javajigi@slipp.net');
      INSERT INTO USER (id, user_id, password, name, email) VALUES (2, 'sanjigi', 'test', 'ì‚°ì§€ê¸°', 'sanjigi@slipp.net');
      ```

### ê°œì¸ì •ë³´ ìˆ˜ì •

> íšŒì›ê°€ì…í•œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

> ì´ë¦„, ì´ë©”ì¼ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš©ì ì•„ì´ë””ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ë‹¤.

> ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ë‹¤.

- [X] ê°œì¸ì •ë³´ìˆ˜ì • ë©”ë‰´
    - base.htmlì˜ ê°œì¸ì •ë³´ìˆ˜ì • ë©”ë‰´ì— `/{id}/form` url ë§í¬ ì¶”ê°€

- [X] id ì²´í¬
    - ë¡œê·¸ì¸í•œ userì˜ idì™€ ê°™ì„ ê²½ìš°ì—ë§Œ ê°œì¸ì •ë³´ìˆ˜ì • ê°€ëŠ¥
    - í˜„ì¬ ë¡œê·¸ì¸í•œ userì˜ id ê°€ì ¸ì˜¤ê¸°
      ```java
       Object value = session.getAttribute(â€sessionedUser");
       if (value != null) {
         User user = (User)value;
       }
      ```
    - ë‹¤ë¥¸ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì‹œë„(id ì²´í¬ì— ì‹¤íŒ¨) ì‹œ ì—ëŸ¬ í˜ì´ì§€ë¡œ ì´ë™

### ì§ˆë¬¸ ê¸°ëŠ¥ êµ¬í˜„
> ì‚¬ìš©ìëŠ” ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆìœ¼ë©°, ëª¨ë“  ì§ˆë¬¸ì„ ë³¼ ìˆ˜ ìˆë‹¤.

> ë‹¨, ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì€ ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ í•  ìˆ˜ ìˆë‹¤.

> ì§ˆë¬¸í•œ ì‚¬ëŒì€ ìì‹ ì˜ ê¸€ì„ ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆë‹¤.

- [X] ì§ˆë¬¸í•˜ê¸° êµ¬í˜„
    - ê¸€ì“´ì´ ì…ë ¥ í•„ë“œ ì‚­ì œ
        - Questionì˜ ê¸€ì“´ì´ ê°’ == í˜„ì¬ ë¡œê·¸ì¸ í•œ Userì˜ name ê°’
    - ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì§ˆë¬¸ í˜ì´ì§€ ì ‘ê·¼
        - ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™

- [X] ì§ˆë¬¸ ìˆ˜ì •í•˜ê¸° êµ¬í˜„
    - id ì²´í¬
        - ë¡œê·¸ì¸ ì‚¬ìš©ì id == ê¸€ì“´ì´ì˜ ì‚¬ìš©ì ì•„ì´ë”” ì²´í¬
        - ìˆ˜ì •í™”ë©´ ì ‘ê·¼/ìˆ˜ì •í•˜ê¸° ì ‘ê·¼ ì‹œ ì²´í¬
    - ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì í˜¹ì€ ê¸€ì“´ì´ê°€ ì•„ë‹Œ ì‚¬ìš©ìê°€ ì§ˆë¬¸ í˜ì´ì§€ ì ‘ê·¼
        - ì—ëŸ¬ í˜ì´ì§€ ì´ë™
        - ì—ëŸ¬ ë©”ì‹œì§€ "ë‹¤ë¥¸ ì‚¬ëŒì˜ ê¸€ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ë‹¤."
    - @PutMapping
        - updateForm.htmlì˜ formì„ PUT method ê°’ìœ¼ë¡œ ì „ì†¡
            - `<input type="hidden" name="_method" value="PUT" />` ì¶”ê°€
- [X] ì§ˆë¬¸ ì‚­ì œí•˜ê¸° êµ¬í˜„
    - id ì²´í¬
        - ë¡œê·¸ì¸ ì‚¬ìš©ì id == ê¸€ì“´ì´ì˜ ì‚¬ìš©ì ì•„ì´ë”” ì²´í¬
        - ì§ˆë¬¸ ì‚­ì œ ì‹œë„ ì‹œ ì²´í¬
    - ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì í˜¹ì€ ê¸€ì“´ì´ê°€ ì•„ë‹Œ ì‚¬ìš©ìê°€ ì§ˆë¬¸ ì‚­ì œ ì‹œë„
        - ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™
    - @DeleteMapping
        - formì„ PUT method ê°’ìœ¼ë¡œ ì „ì†¡
        - <input type="hidden" name="_method" value="DELETE" /> ì¶”ê°€
    
    
### Userì™€ Question ì—°ê²° ì‹¤ìŠµ
> í˜„ì¬ Questionì˜ ê¸€ì“´ì´ëŠ” Userì˜ name ê°’ì„ ê°€ì§€ëŠ” ê²ƒìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤.

> ì´ì™€ ê°™ì´ êµ¬í˜„í•˜ëŠ” ê²½ìš° Userì˜ nameì„ ìˆ˜ì •í•˜ëŠ” ê²½ìš° Questionì˜ ê¸€ì“´ì´ì™€ ë‹¤ë¥¸ ê°’ì„ ê°€ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Userì˜ nameì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ Questionì˜ writer ê°’ì„ ìˆ˜ì •í•  ìˆ˜ë„ ìˆì§€ë§Œ ì´ì™€ ê°™ì´ êµ¬í˜„í•  ê²½ìš° writerê°€ ê°™ì€ ì´ë¦„ì„ ê°€ì§€ëŠ” ê²½ìš° ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤.

- [X] Userì˜ idë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²• ë³€ê²½
  - Userì˜ primary keyì¸ id ê°’ì„ Questionì— ì €ì¥
  - Questionì„ ì¡°íšŒí•  ë•Œ id ê°’ì„ í†µí•´ Userë„ ê°™ì´ ì¡°íšŒ
  - @ManyToOne ë§¤í•‘ í™œìš©
    ```java
    @Entity
    public class Question {
        @ManyToOne
        @JoinColumn(foreignKey = @ForeignKey(name = "fk_question_writer"))
        private User writer;

        [...]
    }
    ```

### Answer êµ¬í˜„í•˜ê¸°
> ì‚¬ìš©ìëŠ” ì§ˆë¬¸ ìƒì„¸ë³´ê¸° í™”ë©´ì—ì„œ ë‹µë³€ ëª©ë¡ì„ ë³¼ ìˆ˜ ìˆë‹¤.

> ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ë‹µë³€ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

> ìì‹ ì´ ì“´ ë‹µë³€ì„ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.

- [X] Answer í´ë˜ìŠ¤ êµ¬í˜„
   - DBì™€ì˜ ë§¤í•‘
     - `@ManyToOne` : Question - Answer = one-to-many ê´€ê³„
     - `@JoinColumn` : Question í…Œì´ë¸”ì— ëŒ€í•œ ì™¸ë˜í‚¤ ì„¤ì •

     ```java
     @Entity
        public class Answer {
            @ManyToOne
            @JoinColumn(foreignKey = @ForeignKey(name = "fk_answer_to_question"))
            private Question question;
        
            [...]
     }
     ```
   - ê·¸ë°–ì— í•„ìš”í•œ í•„ë“œ
       - answer ì‘ì„±ì ì •ë³´ â†’ User writer 
         - `@ManyToOne` User - Answer = one-to-many ê´€ê³„
         - `@JoinColumn` : User í…Œì´ë¸”ì— ëŒ€í•œ ì™¸ë˜í‚¤ ì„¤ì •
       - ì‘ì„± ì‹œê°„ â†’ LocalDateTime createAt
       - ë‚´ìš© â†’ String contents
       - id â†’ Long id

- [X] AnswerRepository ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
   - íŠ¹ì • Questionì— ì¢…ì†ë˜ì–´ìˆëŠ” Answer ëª©ë¡ ì¡°íšŒ ë©”ì†Œë“œ
     - findByQuestionId() ì¶”ê°€
    
- [X] AnswerController í´ë˜ìŠ¤ êµ¬í˜„
   - @Controller ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
     
   - create() êµ¬í˜„
     - ì§ˆë¬¸í•˜ê¸° ê¸°ëŠ¥ ìˆ˜í–‰
     - @PostMapping("/questions/{questionId}/answers/")
    
   - delete() êµ¬í˜„
     - ì‘ì„±ëœ ë‹µë³€ ê¸€ ì‚­ì œ ê¸°ëŠ¥ ìˆ˜í–‰
     - @DeleteMapping("/questions/{questionId}/answers/{id}")
     - ë§Œì•½ ë¡œê·¸ì¸ ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´, ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
     - ë¡œê·¸ì¸í•œ ìœ ì €ì¼ ê²½ìš°, sessionì„ í†µí•´ id ì²´í¬ í•œ í›„
       - id ì²´í¬ ì„±ê³µ â†’ í•´ë‹¹ ë‹µë³€ ê¸€ ì‚­ì œí•œ í›„ questionIdë¥¼ í†µí•´ í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ ìƒì„¸í˜ì´ì§€ ì´ë™
       - id ì²´í¬ ì‹¤íŒ¨ â†’ ì—ëŸ¬ í˜ì´ì§€ ì´ë™
    
### refactor
- [X] entityì— builder íŒ¨í„´ ì ìš©
  - new í‚¤ì›Œë“œ ìˆ¨ê¸°ê¸°
  - ë¹Œë” ëŒ€ì‹  ê°„ë‹¨í•œ ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œ ì‚¬ìš©
    
 - [X] ì—ëŸ¬ í˜ì´ì§€ ë§Œë“¤ê¸°
      - QuestionController getForm()
      - UserController updateForm()
    
 - [X] ExceptionAdvice í™œìš©
     - [ì°¸ê³ ](https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc)
     - íŠ¹ì • ì—ëŸ¬ ë°œìƒ ì‹œ ì—ëŸ¬ í˜ì´ì§€ë¡œ ì´ë™
     
 - [X] ì„¸ì…˜ ì‚¬ìš© ì½”ë“œ ë¦¬í™í† ë§
    - SessionUtil í´ë˜ìŠ¤ êµ¬í˜„
   - ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ í•©ì¹  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ
     ```java
        if (!SessionUtils.isLoginUser(session)) {
            return "redirect:/users/login-form";
        }
        User user = SessionUtils.getLoginUser(session)
                .orElseThrow(() -> new UserNotFoundException("You are a guest user, please sign in first"));
     ```

### ???

#### ğŸ¤” ì–´ë–¤ê²Œ ë” ì¢‹ì€ ë°©ì‹ì¼ê¹Œ?
#### [1]
 ```java
    public void update(String title, String contents) {
        this.title = title;
        this.contents = contents;
    }
 ```
- ì¢€ ë” ìœ ì—°í•œ êµ¬ì¡°, í•˜ì§€ë§Œ updateí•  ë•Œ êµ³ì´ ìœ ì—°í•œ êµ¬ì¡°ê°€ í•„ìš”í• ê¹Œ? ì•„ì§ ì˜ ëª¨ë¥´ê² ë‹¤.

#### [2]
```java
    public void update(QuestionUpdateRequest question) {
        this.title = question.getTitle();
        this.contents = question.getContents();
    }
```

- questionì„ ì—…ë°ì´íŠ¸í•  ì‹œì— QuestionUpdateRequestë¡œ ë°ì´í„°ë¥¼ ë°›ì„ ë•Œë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ê°•ì œí•  ìˆ˜ ìˆë‹¤.
- QuestionUpdateRequestì— ì˜ì¡´ì ì´ë‹¤. -> ì•„ ì´ê²Œ ì¢€ ë§ì´ ê±¸ë¦¬ëŠ”ë°

#### ğŸš¨ ì»¤ë§¨ë“œ ê°ì²´ ê¸°ë³¸ ìƒì„±ì, ì ‘ê·¼ ì§€ì‹œìê°€ publicì¼ ë•Œ ë¬¸ì œ ë°œìƒ
#### [í•´ê²°]
- protectedë¡œ ìˆ˜ì •í•´ì¤€ ë’¤ ì •ìƒ ë™ì‘
- WHY?

#### ğŸš¨ PostMan url ì ‘ê·¼ ì‹œ ëš«ë¦¬ëŠ” ë¬¸ì œ
  - QuestionControllerì˜ update()ë¥¼ postmanì„ í†µí•´ requestë¥¼ ë³´ë‚´ì£¼ë©´ ëš«ë¦°ë‹¤.
  - Session ì •ë³´ í™•ì¸ìœ¼ë¡œ ë§‰ì•„ì£¼ì–´ì•¼ í•œë‹¤.

#### ğŸš¨ ID ë¹„êµ ê°€ëŠ¥?
- ì˜ˆë¥¼ ë“¤ì–´ Question í´ë˜ìŠ¤ì˜ isMatchingWriter() ë©”ì†Œë“œì˜ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ê°™ì€ userì„ì„ í™•ì¸í•˜ê¸° ìœ„í•´ idë¥¼ ë¹„êµí•´ì¤€ë‹¤.
    ```java
    public boolean isMatchingWriter(User user){
            return writer.isMatchingId(user.getId());
    }
    ```

- í•˜ì§€ë§Œ idëŠ” ìë™ incrementì¸ë° ì—¬ê¸°ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ê°€ ìƒê¸¸ ìˆ˜ ìˆì§€ ì•Šë‚˜? â†’ ê·¸ë£¹ ì½”ë“œ ë¦¬ë·°ì—ì„œë„ ë‚˜ì™”ë˜ ë¬¸ì œ
- userIdë¡œ ë¹„êµí•´ì£¼ì–´ì•¼ í•˜ëŠ”ê±´ê°€?

#### ğŸš¨ JPA ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ VS ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥
- Answer : Question í˜¹ì€ Answer : User ê°€ `ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥`ì¼ ê²½ìš°
  - Answerë§Œ Questionê³¼ Userë¥¼ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— Question í˜¹ì€ User ë°ì´í„°ì— ë³€í™”ê°€ ìˆì„ ê²½ìš° AnswerëŠ” ëª¨ë¥¸ë‹¤.
    
 - ì´ëŸ° ê²½ìš°ì—ëŠ” ì–‘ë°©í–¥ ì¦‰, ì„œë¡œ ì°¸ì¡°í•˜ë„ë¡ í•´ì•¼í•œë‹¤. ë‹¨, ìˆœí™˜ ì°¸ì¡°ì— ì£¼ì˜
    ```java
    public void addAnswer(Answer answer) {
            answers.add(answer);
            if (answer.getQuestion() != this) {
                answer.setQuestion(this);
            }
        }
    ```
    ```java
    public void setQuestion(Question question) {
            this.question = question;
            if (!question.getAnswers().contains(this)) {
                question.getAnswers().add(this);
            }
        }
    ```
   - ìˆœí™˜ ì°¸ì¡°ì— ëŒ€í•œ ê¹€ì˜í•œë‹˜ì˜ ì¡°ì–¸ - [ì°¸ì¡°](https://www.inflearn.com/questions/14559)
     - APIë‹¹ ë³„ë„ì˜ **DTO í´ë˜ìŠ¤**ë¥¼ ë§Œë“¤ì–´ì„œ ì¤‘ê°„ì— ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜í•˜ê³ , ë³€í™˜í•œ DTOë¥¼ JSONìœ¼ë¡œ ë°”ê¾¸ì‹œëŠ” ê²ƒì„ ê¶Œì¥
     - ì•„ì§ 100% ì™€ë‹¿ì§€ëŠ” ì•ŠìŒğŸ˜‚ ì•Œì•„ë§Œ ë‘ì.
   - ì—°ê´€ê´€ê³„ì— ëŒ€í•œ ìì„¸í•œ ì†ì„± ê°’ë“¤ - [ì°¸ì¡°](https://data-make.tistory.com/611)

- CascadeType.ALLì´ @ManyToOneì— ìˆë‹¤ëŠ” ê±´
  - ë§ë§ë§ [ì°¸ê³ ](https://stackoverflow.com/questions/13027214/what-is-the-meaning-of-the-cascadetype-all-for-a-manytoone-jpa-association)
  - ì•„ë˜ ì˜ˆì‹œì˜ ê²½ìš° Addressë¥¼ ì§€ìš°ë©´ Userê°€ í•¨ê»˜ ì§€ì›Œì§. ê·¸ë¦¬ê³  í•´ë‹¹ User ê°’ì„ ê°€ì§€ê³ ìˆë˜ ë‹¤ë¥¸ AddressëŠ” ê³ ì•„(orphans)ê°€ ë¨. ë”°ë¼ì„œ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ë ¤ë©´ Userì— CascadeType.ALLì„ ë¶™ì—¬ì•¼ í•œë‹¤.
    ```java
    public class User {

        @OneToMany(fetch = FetchType.EAGER)
        protected Set<Address> userAddresses;
    
    }
    
    public class Address {
    
        @ManyToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)
        protected User addressOwner;
    
    }
    ```
    
  - [What is the difference between mappedBy and CascadeType.ALL?](https://stackoverflow.com/questions/52030247/what-is-the-difference-between-mappedby-and-cascadetype-all)
    - ONE-TO-MANY relationship between A and B
    - [Option 1] CascadeType
      - í•˜ì´ë²„ë„¤ì´íŠ¸ì—ê²Œ Aì˜ ì–´ë–¤ operationë“¤ì´ Bì—ê²Œë„ ì ìš©ë˜ëŠ”ì§€ ì•Œë ¤ì¤Œ
      - ì˜ˆë¥¼ ë“¤ì–´ CascadeType.Remove ì„¤ì •í•˜ì§€ ì•Šì•˜ì„ ê²½ìš°, Aê°€ removeë  ë•Œ BëŠ” removeëœë‹¤ëŠ” ë³´ì¥ì´ ì—†ìŒ
      - ( operation ì¢…ë¥˜ - "delete" / "remove", "detach" / "evict", "merge", "persist", "save_update" / "update" ë“±ë“± ì•„ì§ê¹Œì§€ ì •í™•í•˜ê²ŒëŠ” ë­”ëœ»ì¸ì§€ ëª¨ë¥´ê² ë‹¤ )
    - [Option 2] mappedBy
      - Aì™€ Bê°€ ì–‘ë°©í–¥ ê´€ê³„ì„ì„ ì„ ì–¸
      - [ì°¸ê³ ](https://kok202.tistory.com/138)

#### ğŸš¨ mappedBy ì´ë¦„ì— ì£¼ì˜í•˜ì
 - mappedBy reference an unknown target entity property: ì—ëŸ¬ ë°œìƒ â†’ ì›ì¸ì€ mappedBy ì´ë¦„ì„ ì˜ëª» í‘œê¸°í–ˆê¸° ë•Œë¬¸
    [[ì°¸ê³ ]](https://stackoverflow.com/questions/4011472/mappedby-reference-an-unknown-target-entity-property)
 - User í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ì•„ë˜ì™€ ê°™ì´ "writer"ë¼ê³  ì‘ì„±í•´ì•¼ í•œë‹¤.
  ```java
    @OneToMany(mappedBy = "writer")
    private List<Answer> answers = new ArrayList<>();
  ```
  - WHY? ë‚´ê°€ Answer í´ë˜ìŠ¤ì—ì„œ User í•„ë“œë¥¼ writerë¼ê³  ì„ ì–¸í–ˆê¸° ë•Œë¬¸
  ```java
    @ManyToOne
    @JoinColumn(foreignKey = @ForeignKey(name = "fk_answer_writer"))
    private User writer;
  ```

#### ì§€ì—° ë¡œë”©
  - @ManyToOne ì†ì„±ì— fetch = FetchType.LAZY ì¶”ê°€
  - ì‹¤ì œ ì‚¬ìš©ë  ë•Œê¹Œì§€ ë°ì´í„° ë¡œë”©ì„ ë¯¸ë£¬ë‹¤.
