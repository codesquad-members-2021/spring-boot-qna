
## 미션 3. 로그인 구현

### 로그인 기능 구현
> 로그인이 가능해야 한다.

> 로그인 상태 → 상단 메뉴 : “로그아웃”, “개인정보수정”

> 로그아웃 상태 → 상단 메뉴 : “로그인”, “회원가입”

- [X] 로그인 구현
    - UserController에 login() 메소드 구현
        - url `/users/login`과 매핑
            ```java
            @PostMapping("/login")
            public String login(String userId, String password, HttpSession session) {
                // 로그인 로직 구현
            }
            ```
        - 로그인 성공 시 HttpSession에 로그인 정보 추가
           ```java
            session.setAttribute(“sessionedUser", user);
           ```
    - templates/user/login.html 확인
        - 로그인 form의 action의 url → `/users/login`으로 수정

    - UserRepository
        - userId에 해당하는 데이터 조회
      ```java
      public interface UserRepository extends JpaRepository<User, Long>{
          User findByUserId(String userId);
      }
      ```


- [X] 로그인에 따른 메뉴 처리 구현
    - 세션 설정
        - application.properties
            - handlebars에서 HttpSession 데이터를 접근하기 위한 설정
       ```java
        handlebars.expose-session-attributes=true
       ```
        - URL에 jsessionid가 추가되는 이슈를 해결하는 설정
       ```java
        // spring boot 1.5
        server.session.tracking-modes=cookie
        
        // spring boot 2.x
        server.servlet.session.tracking-modes=cookie
       ```
    - HTML 문서에서 if/else 사용
        - if/else 구문으로 로그인 성공 여부에 따라 띄우는 페이지를 다르게 설정한다.
      ```html
      {{^sessionedUser}}
      [[HTML 구문]
      {{/sessionedUser}}
      {{#sessionedUser}}
      [[HTML 구문]
      {{/sessionedUser}}
      ```
      
   - [X] 로그아웃 기능 구현
      - @GetMapping("/logout")
      - 인자로 HttpSession 받기
      - session.removeAttribute("sessionedUser")
    
### 테스트 데이터 추가
> 로그인 기능을 테스트하기 위해 매번 회원가입을 먼저 해야 한다.

> 로그인 기능을 테스트하는데 어려움이 있다. 테스트 데이터를 미리 추가한 후 개발을 하면 좋겠다.

- [X] 권한 체크에 대한 테스트 데이터 추가
    -  sql 파일을 추가
    - src/main/resources 폴더 아래 data.sql 파일 생성
    - 사용자 데이터 insert sql 쿼리 추가
      ```java
      INSERT INTO USER (id, user_id, password, name, email) VALUES (1, 'javajigi', 'test', '자바지기', 'javajigi@slipp.net');
      INSERT INTO USER (id, user_id, password, name, email) VALUES (2, 'sanjigi', 'test', '산지기', 'sanjigi@slipp.net');
      ```

### 개인정보 수정

> 회원가입한 사용자의 정보를 수정할 수 있어야 한다.

> 이름, 이메일만 수정할 수 있으며, 사용자 아이디는 수정할 수 없다.

> 비밀번호가 일치하는 경우에만 수정 가능하다.

- [X] 개인정보수정 메뉴
    - base.html의 개인정보수정 메뉴에 `/{id}/form` url 링크 추가

- [X] id 체크
    - 로그인한 user의 id와 같을 경우에만 개인정보수정 가능
    - 현재 로그인한 user의 id 가져오기
      ```java
       Object value = session.getAttribute(”sessionedUser");
       if (value != null) {
         User user = (User)value;
       }
      ```
    - 다른 사용자 정보 수정 시도(id 체크에 실패) 시 에러 페이지로 이동

### 질문 기능 구현
> 사용자는 질문을 할 수 있으며, 모든 질문을 볼 수 있다.

> 단, 질문을 할 수 있는 사람은 로그인 사용자만 할 수 있다.

> 질문한 사람은 자신의 글을 수정/삭제할 수 있다.

- [ ] 질문하기 구현
    - 글쓴이 입력 필드 삭제
        - Question의 글쓴이 값 == 현재 로그인 한 User의 name 값
    - 로그인하지 않은 사용자가 질문 페이지 접근
        - 로그인 페이지 이동

- [ ] 질문 수정하기 구현
    - id 체크
        - 로그인 사용자 id == 글쓴이의 사용자 아이디 체크
        - 수정화면 접근/수정하기 접근 시 체크
    - 로그인하지 않은 사용자 혹은 글쓴이가 아닌 사용자가 질문 페이지 접근
        - 에러 페이지 이동
        - 에러 메시지 "다른 사람의 글을 수정할 수 없다."
    - @PutMapping → 이미 추가
        - updateForm.html의 form을 PUT method 값으로 전송
            - `<input type="hidden" name="_method" value="PUT" />` 추가
- [ ] 질문 삭제하기 구현
    - id 체크
        - 로그인 사용자 id == 글쓴이의 사용자 아이디 체크
        - 질문 삭제 시도 시 체크
    - 로그인하지 않은 사용자 혹은 글쓴이가 아닌 사용자가 질문 삭제 시도
        - 로그인 페이지 이동
    - @DeleteMapping
        - form을 PUT method 값으로 전송
        - <input type="hidden" name="_method" value="DELETE" /> 추가
