## 미션1: 회원 가입, 사용자 목록, 질문하기 구현

### ✔ 각 기능에 따른 url과 메소드 convention
- 각 기능에 대한 대표 url을 결정
    - `/users` : 회원관리 기능 대표 url

### ✔ Template engine 추가 설정
- [X] **handlebars** 설정
    - 의존성 추가  ( [참고 링크](github.com/allegro/handlebars-spring-boot-starter) )
      ```java
          dependencies {
              compile 'pl.allegro.tech.boot:handlebars-spring-boot-starter:0.3.2'
          }
      ```

    - Configuration 설정
        - application.properties
          ```java
            handlebars.suffix=.html
            handlebars.cache=false
          ```


### 회원가입 기능 구현

- [X] 회원가입 페이지 `static/user/form.html` (static -> templates 이동)
- [X] 사용자 관리 기능 구현을 담당할 UserController를 추가하고 @Controller 애노테이션 맵핑(추가)
- [X] POST 메소드
    - 회원가입하기 요청(POST 요청 @PostMapping)을 처리할 메소드를 추가하고 URL 매핑한다.
- [X] User 객체 매핑
    - 사용자가 전달한 값을 User 클래스를 생성해 저장한다.
- [X] User 클래스 setter/getter
    - User 클래스 회원가입할 때 전달한 값을 저장할 수 있는 필드를 생성한 후 setter와 getter 메소드를 생성한다.
- [X] 사용자 목록 ArrayList
    - 사용자 목록을 관리하는 ArrayList를 생성한 후 앞에서 생성한 User 인스턴스를 ArrayList에 저장한다.
- [X] 리디렉션
    - 사용자 추가를 완료한 후 사용자 목록 페이지("redirect:/users")로 이동한다.


### 회원목록 기능 구현

- [X] 회원목록 페이지 `static/user/list.html` (static -> templates 이동)
- [X] GET 메소드
    - 회원목록 요청(GET 요청 @GetMapping)을 처리할 메소드를 추가하고 URL 매핑
- [X] 모델에 사용자 목록 데이터 저장
    - Model을 메소드의 인자로 받은 후 Model에 사용자 목록을 users라는 이름으로 전달한다.
- [X] 뷰 리턴
    - 사용자 목록을 user/list.html로 전달하기 위해 메소드 반환 값을 `"user/list"`로 한다.
- [X] 출력
    - user/list.html 에서 사용자 목록을 출력한다.
  ```java
    {{#users}}
        // 데이터 조회
    {{/users}}
  ```
    - Controller 클래스는 회원가입하기 과정에서 추가한 UserController를 그대로 사용한다.

### 회원 프로필 정보보기

- [X] 회원 프로필 보기 페이지 `static/user/profile.html` (static -> templates 이동)

- [X] 페이지 이동
    - 앞 단계의 사용자 목록 html인 user/list.html 파일에 닉네임을 클릭하면 프로필 페이지로 이동하도록 한다.
    - html에서 페이지 이동은 <a /> 태그를 이용해 가능하다.
      ```html 
      <a href="/users/{{userId}}" />
      ```

- [X] GET 메소드
    - 회원프로필 요청(GET 요청 @GetMapping)을 처리할 메소드를 추가하고 URL 매핑 (`/users/{userId}`)

- [X] @PathVariable 애노테이션
    - URL을 통해 전달한 사용자 아이디 값은 @PathVariable 애노테이션을 활용해 전달 받을 수 있다.

- [X] 모델에 특정 데이터 저장
    - ArrayList에 저장되어 있는 사용자 중 사용자 아이디와 일치하는 User 데이터를 Model에 저장한다.

- [X] 출력
    - user/profile.html 에서는 Controller에서 전달한 User 데이터를 활용해 사용자 정보를 출력한다.

- Controller 클래스는 앞 단계에서 사용한 UserController를 그대로 사용한다.

## 리펙토링

### HTML의 중복 제거
>index.html, /user/form.html, /qna/form.html 코드를 보면 header, navigation bar, footer 부분에 많은 중복 코드가 있다. 중복 코드를 제거한다.

👀 **html 중복 제거 힌트**

- [X] 중복 코드가 발생하는 부분을 별도의 template 파일로 분리한다.

### URL과 html 쉽게 연결하기
> 앞 단계와 같이 html에서 중복을 제거하는 기능은 handlebars.java template engine에서 제공하는 기능이다.
따라서 모든 html의 중복을 제거하려면 static의 html 또한 templates 폴더로 이동하고 URL 매핑을 해야 한다.
그런데 이와 같이 구현할 경우 특별한 로직이 없음에도 불구하고 매번 메소드를 만들고 매핑하는 일이 귀찮은 작업이다. 이 같은 단점을 아래 MvcConfig 클래스로 보완할 수 있다.
- [X] config 패키지 생성
- [X] MvcConfig 클래스 생성
 ```java
 @Configuration
public class MvcConfig extends WebMvcConfigurerAdapter {
  @Override
  public void addViewControllers(ViewControllerRegistry registry) {
    registry.setOrder(Ordered.HIGHEST_PRECEDENCE);
    registry.addViewController("/users/form").setViewName("user/form");
    registry.addViewController("/users/login").setViewName("user/login");
    registry.addViewController("/questions/form").setViewName("qna/form");
  }
}
 ```

### 그밖의 리펙토링
- [X] qna 루트 디렉토리 아래 web 디렉토리 추가

### 질문하기 기능 구현

- [X] QuestionController 구현
  - 질문하기 기능 구현 담당
  - @Controller 어노테이션 매핑
  
- [X] index.html에서 질문하기 카테고리 url 링크 수정
  - url 링크 : "/questions/form"
  - 뷰 컨트롤러 추가 : MvcConfig 클래스에서 url 경로 "/questions/form"와 뷰 "qna/form" 매핑

- [X] Question 클래스 구현
  - getter/setter 구현
  - 필드 값
    - String writer
    - String title
    - String contents

- [X] qna/form.html에서 url 링크 수정
  - 질문하기 form의 action url 링크 수정
    → url 링크 : "/questions"

- [X] POST 메소드 create()
  - @PostMapping("/questions") 
  - 질문 관련 데이터 저장
  - 리디렉션 : "redirect:/" 리턴
  
- [X] Question 클래스 필드 추가
  - id 인스턴스 변수 추가

- [X] Question id 업데이트
  - create() 호출 시 (ArrayList에 질문 객체를 추가 시) 질문 객체 id 는 ArrayList.size() + 1
  
### 질문 목록 기능 구현

- [X] GET 메소드
  - @GetMapping("/")
  - 뷰(질문 목록 조회 페이지) 리턴
    - "qna/show" 뷰 리턴

- [X] 질문 목록 관리 ArrayList
  - List<Question> questions, QuestionController 필드에 생성
  - create() POST 메소드에서 인자로 받은 question 인스턴스를 질문 목록에 저장
    → questions.add(question)
    
- [X] 질문 상세 페이지 접근 URL "/questions/{index}"
  - 질문 목록 관리 ArrayList에서 index - 1 해당하는 데이터 조회
  - 해당 데이터를 Model에 저장
  - "/qna/show" 뷰 리턴
  
### 회원정보 수정

- [X] 개인 정보 수정 화면 
  - "updateForm.html" 생성
  - /user/form.html 파일 복사

- [X] user/list.html에서 수정 url 링크 수정
  - 수정 버튼의 href url 링크 수정
    → url 링크 :"/users/{{userId}}/form"
    
- [X] GET 메소드
 - @GetMapping("/users/{userId}/form")
 - @PathVariable 활용 - (@PathVariable String id)

- [X] POST 메소드
 - @PostMapping("/users/{id}/update")
 - 리다이렉트 "redirect:/users"

- [X] 비밀번호 일치할 때 개인정보 수정 가능

- [X] 브라우저에서 개인 정보 수정 화면 확인
  - Controller에서 전달한 값을 입력 폼에서 출력하려면 value를 사용
  - `<input type="text" name="name" value="{{name}}" />`

### 겪었던 문제

- WARNING: Illegal reflective access by com.github.jknack.handlebars.context.MemberValueResolver 발생
  - [링크](https://github.com/jknack/handlebars.java/issues/667) 에 보면 java 8-11까지는 해당 warnning이 작동하지 않는 것 같았다.
  - 현재 프로젝트가 openjdk-15를 사용하고 있어서 jdk1.8로 바꿔주었다.
  
- LocalDateTime 관련
  - HTML 화면에 출력되지 않음
    - Handlebars 헬퍼로 format 설정 -> 실패
      ```javascript
        Handlebars.registerHelper("formatTime", function (datetime) {
            return (new Date(datetime)).format("yyyy-MM-dd HH:mm:ss");
        });
      ```
    - 직접 getter에서 format 설정한 후 String 리턴
      
  - 질문 생성 시간 필드명 : `createAt`
  - [링크](https://stackoverflow.com/questions/3759524/django-naming-conventions-for-dates)


### 코드리뷰 정리
#### 1. 접근 지시자
  - [ ] private List<Question> questions
    - 왜그랬을까 재빨리 붙이자
    ```java
    @Controller
    public class QuestionController {
  
       List<Question> questions = new ArrayList<>(); 👈👈 😱
    ```

#### 2. users 공통 url
  - [ ] UserController, @RequestMapping("/users")
  - QuestionController의 questions는 지금 상황에서는 솔루션이 없다
  - 하지만 `Service 객체가 구성된다면 컨트롤러 분리를 통해 대응할 수 있어 보입니다`
     - 아직 정확하게 이해가 되진 않지만 스프링을 공부하면서 천천히 알아가야할 것 같다.
  - [리뷰] UserController의 경우에는 `/users` 공통 url을 묶을 수 있어 보인다
    - 이런 것까지 통일성을 맞출 필요는 없었나보다..!😅
  
#### 3. 데이터를 숨기고 함수를 공개하자
 - [ ] User 클래스에 현재 인스턴스의 password와 인자로 받은 password를 비교하는 메소드 생성
   ```java
   public String updateProfile(User updatedUser, String oldPassword){
        for(int i = 0; i < users.size(); i++){
            User user = users.get(i);
            if (user.getPassword().equals(oldPassword)) { // 👈👈 게터 없이 로직 수행하는 것이 좋다.
   ```
 - [리뷰] 리뷰어님이 제안해주신 방법은 **User 클래스 내부에 메소드를 만들어 비교**해주는 방식!
   ```java
   public boolean isMatchingPassword(String password)
   ```
   - 디미터의 법칙과 비슷한 맥락이라고 생각했다! - 클린코드 123p
  
#### 4. 정규식은 필요할 때만!
 - [ ] 정규식을 통해 예외를 던지는 대신, 예외 발생 시 try-catch로 예외 처리
     - 아직 
   - [리뷰] 정규식 매칭 없이도 적절한 예외 캐치를 통해 대응할 수 있는 부분
   ```java
    public static Integer stringToInt(String stringInt){
        if(stringInt.matches("\\d+")){ // 👈👈 예외를 처리하도록 해주자
            return Integer.parseInt(stringInt);
        }
        throw new IllegalArgumentException(stringInt + " is not a numeric value!");
    }
   ```
   - ? 그럼, 어떻게 예외 처리를 할까?
     1. catch문에서 추상화 수준이 높은 예외를 던져준다?(throw new IllegalArgumentException 그대로 유지?)
     2. 사용자에게 적합한 안내를 해준다(해당 에러와 관련된 뷰를 리턴한다) - 이게 더 좋아보임
       - <최범균 스프링 5, chapter 14 - 7. 컨트롤러 익셉션 처리하기> 399p 참고해보기
       - `@ExceptionHandler` 사용
#### 5. 예외 처리
 - [ ] Custom Exception을 만들어 사용해보자
 - [리뷰] 기왕에 **명시적으로 예외를 던지기로 했다면** 직접 설계한 예외 객체를 활용해보는 것도 좋을 뻔했네요
    - [사용자 정의 예외(Custom Exception) 언제 써야 할까?](https://woowacourse.github.io/javable/post/2020-08-17-custom-exception/)
    - 물론 모든 상황에서 Custom Exception을 구현해 사용할 필요는 없다
      1. 표준 예외를 사용하면 익숙한 예외이므로 가독성이 높다.
      2. 일일이 예외를 만들게되면 커스텀 예외가 너무 많아진다. → 메모리 문제, 클래스 로딩 문제, 클래스·디렉터리 관리 비용↑
    - 하지만 필요한 상황은 분명히 있다!
      1. Custom Exception의 이름만으로도 정보 전달이 가능하다! 좀 더 특수한 상황에 맞는 예외 정보를 전달해줄 수 있다.
      2. 상세한 예외 정보를 제공할 수 있다! → 상세한 예외 처리를 한 곳에서는 OK, 여러 곳에서 중복해서 상세한 예외 작성을 해야하는 경우에는 클래스로 묶는 것도 구웃
      3. 예외에 대한 응집도 향상 → 해당 예외와 관련된 처리를 Custom Excetion 클래스 한 곳에서!(책임 분리)
      4. 예외 발생 후 처리가 용이 → 예외의 상속성을 이용해 예외 처리 코드를 줄일 수 있다.(일관성도 보장)
      5. 예외 생성 비용을 절감 → stack trace 생성 비용을 줄일 수 있다! 딱 필요한 부분만을 일부 생성하게끔 만들 수 있다.
    - 😅 4, 5번은 아직 완전하게 와닿지는 않지만 다시 봤을 때는 조금 더 이해할 수 있기를.. 
