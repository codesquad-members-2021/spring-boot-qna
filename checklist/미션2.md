## ë¯¸ì…˜ 2. ë°ì´í„°ë² ì´ìŠ¤ í™œìš©

## ê°•ì˜ ë“£ê¸°
- [ ] H2 DB ì¶”ê°€ ë° ì„¤ì •
    - H2 ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì˜ì¡´ê´€ê³„ ì„¤ì • ë° ì„¤ì •
    - H2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬íˆ´ í™•ì¸

- [ ] íšŒì›ê°€ì…, ëª©ë¡ ê¸°ëŠ¥ êµ¬í˜„
    - ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ ìë°” ê°ì²´ë¥¼ ë§¤í•‘
    - íšŒì›ê°€ì… ê¸°ëŠ¥ì„ DBë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
    - íšŒì›ëª©ë¡ ê¸°ëŠ¥ì„ DBë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •

- [ ] ê°œì¸ì •ë³´ ìˆ˜ì • ê¸°ëŠ¥ êµ¬í˜„
    - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì˜ ê¸°ë³¸ íë¦„ì„ ì´í•´í•  ë•Œ ê°€ì¥ ë³µì¡í•œ ê³¼ì • ì¤‘ì˜ í•˜ë‚˜ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì¶”ê°€ëœ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒ
    - 2í¸ì— ê±¸ì³ì„œ ê°•ì˜ ì§„í–‰

## ì‚¬ìš©ì ë°ì´í„°ë¥¼ DBì— ì €ì¥

### ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

- [X] ì˜ì¡´ê´€ê³„ ì„¤ì •
    - | build.gradle | - spring-boot-starter-data-jpa, h2 ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì„¤ì •
       ```xml
      dependencies {
          implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
          runtimeOnly 'com.h2database:h2'
      }
       ```
        - [ì°¸ê³ ](https://spring.io/guides/gs/accessing-data-jpa/)
    - | application.properties | - DB Connection ì„¤ì •
      ```java
         spring.datasource.url=jdbc:h2:mem://localhost/~/java-qna;MVCC=TRUE;DB_CLOSE_ON_EXIT=FALSE
         spring.datasource.driverClassName=org.h2.Driver
         spring.datasource.username=sa
         spring.datasource.password=
         
         spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
      ```
    - | application.properties | - í…Œì´ë¸” ìë™ ìƒì„± ì„¤ì •
        - ì„œë²„ ì‹œì‘ ì‹œì ì— DB í…Œì´ë¸” dropí›„ ë‹¤ì‹œ ìƒì„±í•˜ë„ë¡ ì„¤ì • â†’ ğŸ‘€ ì¼ë‹¨ ì²˜ìŒì—ëŠ” ì´ê±¸ë¡œ ì„¤ì •í•´ë³´ì
            ```java
            spring.jpa.hibernate.ddl-auto=create-drop
            ```
        - ì„œë²„ ì‹œì‘ ì‹œì ì— DB í…Œì´ë¸”ì´ dropí•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•˜ëŠ” ë°©ë²•
            ```java
            spring.jpa.hibernate.ddl-auto=create-drop
            ```
    - | application.properties | - ì‹¤í–‰ ì¿¼ë¦¬ ë³´ê¸° ì„¤ì •
      ```java
      spring.jpa.show-sql=true
      spring.jpa.properties.hibernate.format_sql=true
      ```
    - | application.properties | - h2 db consoleì— ì ‘ê·¼ ì„¤ì •
      ```java
      spring.h2.console.enabled=true
      spring.h2.console.path=/h2-console
      ```

- [X] User í´ë˜ìŠ¤ë¥¼ DB í…Œì´ë¸”ì— ë§¤í•‘
   ```java
   import javax.persistence.Column;
   import javax.persistence.Entity;
   import javax.persistence.GeneratedValue;
   import javax.persistence.GeneratedType;
   import javax.persistence.Id;
   
   @Entity
   public class User {
   @Id
   @GeneratedValue(strategy = GenerationType.IDENTITY)
   private Long id;
   
       @Column(nullable=false, length=20)
       private String userId;
       
       private String password;
       private String name;
       private String email;
       
       [...ê° í•„ë“œì— ëŒ€í•œ setter, getter method...]
   }
   ```
    - [X] ì‚¬ìš©ì ë°ì´í„°ì— ëŒ€í•œ CRUD êµ¬í˜„
        - CrudRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì† â†’ CRUD ê¸°ë³¸ ê¸°ëŠ¥ êµ¬í˜„ ê°€ëŠ¥
       ```java
       import org.springframework.data.jpa.repository.CrudRepository;
 
         public interface UserRepository extends CrudRepository<User, Long>{
            // ...
         }  
       ```

#### Controllerì—ì„œ Repository ì‚¬ìš©
- ë°ì´í„° ì €ì¥ì„ ìœ„í•´ ArrayList ëŒ€ì‹  DB ì‚¬ìš©(Repository í´ë˜ìŠ¤ë¥¼ í™œìš©)
- [X] UserRepository êµ¬í˜„
    - @Autowired ì¶”ê°€

- [X] DBì— ì‚¬ìš©ì ë°ì´í„° ì¶”ê°€
- UserRepositoryì˜ save() ë©”ì†Œë“œ
  ```java
  @Controller
  @RequestMapping("/users")
  public class UserController {
  
  @Autowired
  private UserRepository userRepository;
  
  @PostMapping("")
  public String create(User user) {
      System.out.println("user : " + user);
      userRepository.save(user);
      return "redirect:/users";
    }
  }

  ```

- [X] DBì—ì„œ ì „ì²´ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
    - UserRepositoryì˜ findAll() ë©”ì†Œë“œ
      ```java
      @Controller
      @RequestMapping("/users")
      public class UserController {
        
      @Autowired
      private UserRepository userRepository;
        
        [... ì‚¬ìš©ì ì¶”ê°€ ì½”ë“œ ...]
        
      @GetMapping("")
      public String list(Model model) {
           model.addAttribute("users", userRepository.findAll());
           return "/user/list";
        }
      }
  
      ```

- [X] DBì—ì„œ íŠ¹ì • ì‚¬ìš©ì ì¡°íšŒ
    - ì‚¬ìš©ì ëª©ë¡ì„ ì¶œë ¥í•˜ëŠ” ê³³ì—ì„œ {{@index}}ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  {{id}}ë¥¼ ì‚¬ìš©
    - UserRepositoryì˜ findOne() ë©”ì†Œë“œ
      ```java
      @Controller
      @RequestMapping("/users")
      public class UserController {
      @Autowired
      private UserRepository userRepository;
        
      @GetMapping("/{id}")
      public ModelAndView show(@PathVariable long id) {
         ModelAndView mav = new ModelAndView("user/profile");
         mav.addObject("user", userRepository.findById(id).get());
         return mav;
        }
      }
  
      ```

### ì‹¤ìŠµ - ì§ˆë¬¸ ë°ì´í„°ë¥¼ DBì— ì €ì¥ ë° ì¡°íšŒ
#### ì§ˆë¬¸ ë°ì´í„° ì €ì¥í•˜ê¸°
- [ ] Question í´ë˜ìŠ¤ë¥¼ DB í…Œì´ë¸”ê³¼ ë§¤í•‘
    - @Id, @GeneratedValue - key ìƒì„±
    - @Column - í•„ë“œì™€ í…Œì´ë¸” ì¹¼ëŸ¼ í•‘
- [X] QuestionRepostory êµ¬í˜„
   - extends CrudRepository
- [ ] QuestionControllerì™€ QuestionRepoistory ì˜ì¡´ê´€ê³„ ì„¤ì •
   - @Autowired ì¶”ê°€
- [ ] Question ë°ì´í„°, DBì— ì €ì¥
   - QuestionRepositoryì˜ save() êµ¬í˜„

#### ì§ˆë¬¸ ëª©ë¡ êµ¬í˜„í•˜ê¸°
- [ ] ì „ì²´ ì§ˆë¬¸ ëª©ë¡ ë°ì´í„° ì¡°íšŒ
   - QuestionRepositoryì˜ findAll() êµ¬í˜„

#### ì§ˆë¬¸ ìƒì„¸ë³´ê¸° êµ¬í˜„í•˜ê¸°
- [ ] íŠ¹ì • ì§ˆë¬¸ ë°ì´í„° ì¡°íšŒ
    - QuestionRepositoryì˜ findOne() êµ¬í˜„

### íšŒì›ì •ë³´ ìˆ˜ì •

- [X] ê°œì¸ì •ë³´ ìˆ˜ì • í™”ë©´
    - updateForm(@PathVariable String id) ë©”ì†Œë“œ ì‹œê·¸ë‹ˆì²˜ ìˆ˜ì •

- [X] íšŒì› ì •ë³´ ìˆ˜ì • ë¡œì§ ë³€ê²½
    - ìˆ˜ì •í•œ ì •ë³´ë¥¼ User í´ë˜ìŠ¤ì— ì €ì¥
        - User ì»¤ë§¨ë“œ ê°ì²´ë¡œ ìš”ì²­ íŒŒë¼ë¯¸í„° ì‚¬ìš©
    - urlë¡œ ë°›ì€ {id}ë¥¼ í†µí•´ í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ DBì—ì„œ ì¡°íšŒ
        - UserRepositoryì˜ findOne() ì‚¬ìš©
    - DBì—ì„œ ì¡°íšŒí•œ User ë°ì´í„°ë¥¼ ìƒˆë¡œ ì…ë ¥ë°›ì€ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
        - UserRepositoryì˜ save() ë©”ì†Œë“œë¥¼ ì‚¬ìš©

- [X] ìˆ˜ì • ì •ë³´ ì „ë‹¬ ì‹œ PUT ë©”ì†Œë“œ ì‚¬ìš©
    - ìˆ˜ì •ëœ ê°’ì„ ì „ì†¡í•  ë•Œ PUTê°’ì„ `hidden`ìœ¼ë¡œ ì „ì†¡
      ```html
      <input type="hidden" name="_method" value="PUT" />
      ```
      - html form ìì²´ì—ì„œëŠ” putê³¼ post ë°–ì— ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. 
      - [Using PUT method in HTML form](https://stackoverflow.com/questions/8054165/using-put-method-in-html-form)
    - `_method`ìœ¼ë¡œ PUT ì „ë‹¬ ì‹œ UserControllerì˜ @PutMappingìœ¼ë¡œ URLì„ ë§¤í•‘ ê°€ëŠ¥

### ë¦¬í™í† ë§

 - [ ] @Autowired ëŒ€ì‹  ìƒì„±ìë¡œ Repository ì˜ì¡´ì„± ì£¼ì…
 - [ ] Entity ê°ì²´ setter ì œê±°, ìƒì„±ì ì •ì˜
 - [ ] Repositoryê°ì²´.findById().get() ì§€ì–‘
     - [Optional ì œëŒ€ë¡œ í™œìš©í•˜ê¸°](https://www.latera.kr/blog/2019-07-02-effective-optional/)

### ì—ëŸ¬
- updateFormì—ì„œ usedrIdë¥¼ ëª»ì½ì–´ì˜¤ëŠ” í˜„ìƒ
  - `disabled` í‚¤ì›Œë“œ ëŒ€ì‹  `readonly="true"` ì‚¬ìš©
    - [ì°¸ê³  - How can I get the form value from a disabled input element](https://stackoverflow.com/questions/524222/how-can-i-get-the-form-value-from-a-disabled-input-element/679397)

